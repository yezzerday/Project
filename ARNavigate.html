<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Navigation</title>
    <!-- Import AR.js library -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <!-- Import Mapbox GL JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- AR.js Scene -->
    <a-scene vr-mode-ui="enabled: false" embedded arjs>
        <!-- Define the camera -->
        <a-camera gps-camera rotation-reader></a-camera>

        <!-- 3D arrow for navigation -->
        <a-box gps-entity-place="latitude: 0; longitude: 0;" material="color: red;" scale="1 1 1"></a-box>
    </a-scene>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamFydWRhIiwiYSI6ImNtMDc5ZXViMDEzNGkya3NicGZzaGI1ZncifQ.N2tDCng_RYc0uCAymQ-LdA';  // ใช้ Access Token ของคุณเอง

        // Get user's current location
        navigator.geolocation.getCurrentPosition(successLocation, errorLocation, {
            enableHighAccuracy: true
        });

        function successLocation(position) {
            const userCoords = [position.coords.longitude, position.coords.latitude];

            // Get destination from localStorage
            const destinationData = JSON.parse(localStorage.getItem('destination'));
            const destinationCoords = destinationData.coordinates;

            // Fetch directions from Mapbox Directions API
            fetch(
                `https://api.mapbox.com/directions/v5/mapbox/driving/${userCoords[0]},${userCoords[1]};${destinationCoords[0]},${destinationCoords[1]}?steps=true&geometries=geojson&access_token=${mapboxgl.accessToken}`
            )
                .then(response => response.json())
                .then(data => {
                    const route = data.routes[0].geometry.coordinates;
                    render3DPath(route);
                });
        }

        function errorLocation() {
            alert('Unable to retrieve your location');
        }

        function render3DPath(coordinates) {
            coordinates.forEach(coord => {
                const latitude = coord[1];
                const longitude = coord[0];

                // Create 3D box (representing the path) in AR.js
                const box = document.createElement('a-box');
                box.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);
                box.setAttribute('material', 'color: blue; opacity: 0.8;');
                box.setAttribute('scale', '1 1 1');
                document.querySelector('a-scene').appendChild(box);
            });
        }
    </script>
</body>
</html>

