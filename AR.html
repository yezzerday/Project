<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js Demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
    
</head>
<body style='margin: 0; overflow: hidden;'>
    <a-scene
        cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
        raycaster="objects: [gps-entity-place];"
        vr-mode-ui="enabled: false"
		embedded
		arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>

        <a-camera gps-camera rotation-reader></a-camera>
	</a-scene>

    <script>
        window.onload = () => {
            // Load places from static data
            let places = staticLoadPlaces();  // ใช้ข้อมูลพิกัดที่เตรียมไว้
            renderPlaces(places);  // สร้างไอคอนจากพิกัดสถานที่
        };

        // Static data loading function
        function staticLoadPlaces() {
            return [
                {
                    name: "หอสมุด",
                    location: {
                        lat: 16.751810773166465,
                        lng: 100.19707168896952
                    },
                    type: "book"
                },
                {
                    name: "สวนหย่อม",
                    location: {
                        lat: 16.75183459215997,
                        lng: 100.19697807710675
                    },
                    type: "park"
                },
                {
                    name: "test1",
                    location: {
                        lat: 16.75179004919567, 
                        lng: 100.19691306466483
                    },
                    type: "parking"
                },
                {
                    name: "test2",
                    location: {
                        lat: 16.75185399757452, 
                        lng: 100.19693597468412
                    },
                    type: "parking"
                },
                {
                    name: "รถ",
                    location: {
                        lat: 16.751822120330228, 
                        lng: 100.19702598359963
                    },
                    type: "parking"
                },
                {
                    name: "ลาน",
                    location: {
                        lat: 16.752136877263755,
                        lng: 100.19691597965682
                    },
                    type: "parking"
                },
                {
                    name: "จอดรถ",
                    location: {
                        lat: 16.751935684680085, 
                        lng: 100.19670524983876
                    },
                    type: "food"
                },
                {
                    name: "หอศิลป์",
                    location: {
                        lat: 16.750686757445894,
                        lng: 100.19439673985032
                    },
                    type: "museum"
                },
                {
                    name: "ธนาคารกรุงไทย",
                    location: {
                        lat:  16.737478107656056,
                        lng: 100.1992812695405
                    },
                    type: "bank"
                },
                {
                    name: "ฟิตเนส",
                    location: {
                        lat: 16.747186578738877,
                        lng: 100.197390492671
                    },
                    type: "gym"
                }
            ];
        }

        // Load nearby places using Google Maps API
        function dynamicLoadPlaces(coords) {
            let apiKey = 'AIzaSyBdiQ-7RNfSvjBz27tgZ3U495rtCe-xJCE';  // Insert your Google Maps API Key
            let endpoint = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${coords.latitude},${coords.longitude}&radius=1000&key=${apiKey}`;

            return fetch(endpoint)
                .then((res) => res.json())
                .then((data) => {
                    return data.results.map((place) => {
                        return {
                            name: place.name,
                            location: {
                                lat: place.geometry.location.lat,
                                lng: place.geometry.location.lng
                            },
                            type: place.types[0] // Get the first type for category
                        };
                    });
                })
                .catch((err) => {
                    console.error('Error loading places from Google API', err);
                });
        }

        // Function to render places with different icons based on type
        function renderPlaces(places) {
            let scene = document.querySelector('a-scene');

            places.forEach((place) => {
                const latitude = place.location.lat;
                const longitude = place.location.lng;

                // Select icon based on place type
                let iconSrc = '';
                switch (place.type) {
                    case 'book':
                        iconSrc = 'image/book.png';
                        break;
                    case 'park':
                        iconSrc = 'image/park.png';
                        break;
                    case 'parking':
                        iconSrc = 'image/parking.png';
                        break;
                    case 'food':
                        iconSrc = 'image/food.png';
                        break;
                    case 'bank':
                        iconSrc = 'image/bank.png';
                        break;
                    case 'gym':
                        iconSrc = 'image/muscle.png';
                        break;
                    case 'museum':
                        iconSrc = 'image/museum.png';
                        break;
		case 'hospital':
                        iconSrc = 'image/hospital.png';
                        break;
		case 'grad':
                        iconSrc = 'image/grad.png';
                        break;
                    default:
                        iconSrc = 'image/point.png'; // Default icon
                }

                // Create icon for each place
                const icon = document.createElement('a-image');
                icon.setAttribute('gps-entity-place', `latitude: ${latitude}; longitude: ${longitude}`);
                icon.setAttribute('name', place.name);
                icon.setAttribute('src', iconSrc);
                icon.setAttribute('scale', '20, 20');

                icon.addEventListener('loaded', () => window.dispatchEvent(new CustomEvent('gps-entity-place-loaded')));

                icon.addEventListener('click', (ev) => {
                    ev.stopPropagation();
                    ev.preventDefault();

                    const name = ev.target.getAttribute('name');
                    const container = document.createElement('div');
                    container.setAttribute('id', 'place-label');
                    container.innerHTML = `<span>${name}</span>`;
                    document.body.appendChild(container);

                    setTimeout(() => {
                        container.remove();
                    }, 1500);
                });

                scene.appendChild(icon);
            });
        }
    </script>
</body>
</html>


